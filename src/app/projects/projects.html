<section id="projects" class="section-padding bg-white">
  <div class="container">
    <div class="text-center mb-5">
      <h2 class="display-5 fw-bold mb-3">نماذج مشاريعنا</h2>
      <p class="lead text-muted">
        بعض المشاريع التي نفخر بتنفيذها وتوضح خبرتنا في مجال الأنظمة الأمنية.
      </p>
    </div>

    <!-- حالة التحميل -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">جاري التحميل...</span>
      </div>
      <p class="mt-3 text-muted">جاري تحميل المشاريع...</p>
    </div>

    <!-- حالة الخطأ -->
    <div *ngIf="error && !loading" class="alert alert-warning text-center" role="alert">
      <i class="fas fa-exclamation-triangle me-2"></i>
      {{ error }}
      <button class="btn btn-sm btn-outline-primary ms-3" (click)="reloadProjects()">
        <i class="fas fa-redo me-1"></i>
        إعادة المحاولة
      </button>
    </div>

    <!-- شبكة المشاريع -->
    <div *ngIf="!loading && !error" class="row g-4">
      <div *ngFor="let project of projects" class="col-xl-4 col-lg-6 col-md-6">
        <div class="card project-card h-100 border-0 shadow-sm">
          <div class="position-relative overflow-hidden">
            <img
              [src]="project.image"
              [alt]="project.title"
              class="card-img-top"
              (error)="handleImageError($event, project)"
              style="height: 250px; object-fit: cover;"
            />
            <div class="position-absolute top-0 end-0 bg-primary text-white px-3 py-2 rounded-start">
              {{ project.category }}
            </div>
          </div>
          
          <div class="card-body d-flex flex-column">
            <h5 class="card-title fw-bold text-dark">{{ project.title }}</h5>
            <p class="card-text text-muted flex-grow-1">{{ project.description }}</p>
            
            <!-- التقنيات المستخدمة -->
            <div *ngIf="project.technologies && project.technologies.length" class="mb-3">
              <div class="d-flex flex-wrap gap-2">
                <span *ngFor="let tech of project.technologies" class="badge bg-light text-dark border">
                  {{ tech }}
                </span>
              </div>
            </div>
            
            <div class="d-flex justify-content-between align-items-center mt-auto pt-3 border-top">
              <small class="text-muted">
                <i class="fas fa-calendar me-1"></i>
                {{ project.createdAt | date:'shortDate' }}
              </small>
              
              <div class="project-actions">
                <button class="btn btn-primary btn-sm" (click)="showProjectDetails(project)">
                  <i class="fas fa-eye me-1"></i>
                  معاينة
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- حالة عدم وجود مشاريع -->
    <div *ngIf="!loading && !error && projects.length === 0" class="text-center py-5">
      <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
      <h4 class="text-muted">لا توجد مشاريع لعرضها حالياً</h4>
      <p class="text-muted">سيتم إضافة المشاريع قريباً</p>
    </div>

    <!-- Modal لتفاصيل المشروع -->
    <div *ngIf="showModal && selectedProject" class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);" tabindex="-1">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">{{ selectedProject.title }}</h5>
            <button type="button" class="btn-close" (click)="closeProjectDetails()"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6">
                <img 
                  [src]="selectedProject.image" 
                  [alt]="selectedProject.title"
                  class="img-fluid rounded"
                  (error)="handleImageError($event, selectedProject)"
                >
              </div>
              <div class="col-md-6">
                <h6 class="text-primary">{{ selectedProject.category }}</h6>
                <p class="mb-3">{{ selectedProject.description }}</p>
                
                <div *ngIf="selectedProject.technologies" class="mb-3">
                  <strong>التقنيات المستخدمة:</strong>
                  <div class="d-flex flex-wrap gap-2 mt-2">
                    <span *ngFor="let tech of selectedProject.technologies" 
                          class="badge bg-primary">
                      {{ tech }}
                    </span>
                  </div>
                </div>
                
                <small class="text-muted">
                  <i class="fas fa-calendar me-1"></i>
                  تم التنفيذ: {{ selectedProject.createdAt | date:'fullDate' }}
                </small>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeProjectDetails()">
              إغلاق
            </button>
            <button *ngIf="selectedProject.link" 
                    type="button" 
                    class="btn btn-primary"
                    (click)="openProjectLink(selectedProject)">
              <i class="fas fa-external-link-alt me-1"></i>
              زيارة المشروع
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>